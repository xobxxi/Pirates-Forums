<?xml version="1.0" encoding="utf-8"?>
<addon addon_id="smiliesDropdown" title="Smilies Dropdown" version_string="1.0.3" version_id="3" url="http://piratesforums.com" install_callback_class="" install_callback_method="" uninstall_callback_class="" uninstall_callback_method="">
  <admin_navigation/>
  <admin_permissions/>
  <admin_style_properties/>
  <admin_templates/>
  <code_events/>
  <code_event_listeners>
    <listener event_id="template_hook" execute_order="10" callback_class="SmiliesDropdown_Listener" callback_method="template_hook" active="1" description="Uses template hook to spit into js setup"/>
  </code_event_listeners>
  <cron/>
  <email_templates/>
  <optiongroups/>
  <permissions>
    <permission_groups/>
    <permissions/>
    <interface_groups/>
  </permissions>
  <phrases/>
  <route_prefixes/>
  <style_properties/>
  <templates>
    <template title="editor_smiliesDropdown" version_id="3" version_string="1.0.2"><![CDATA[<div id="smiliesDropdown" class="smiliesDropdownFull"></div>
<h3 id="smiliesDropdownHandle"><a href="#">Smilies</a></h3>]]></template>
    <template title="editor_smiliesDropdown.css" version_id="1" version_string="1.0.0"><![CDATA[#ctrl_message_html_tbl {
        border-radius: 3px; -webkit-border-radius: 3px; -moz-border-radius: 3px; -khtml-border-radius: 3px;
}

#smiliesDropdown {
        border: 1px solid #ccc; 
        border-top: none; 
        background: #f0f0ee; 
        padding: 5px 5px 10px 5px;
        border-bottom-right-radius: 6px; -webkit-border-bottom-right-radius: 6px; -moz-border-radius-bottomright: 6px; -khtml-border-bottom-right-radius: 6px;
        border-bottom-left-radius: 6px; -webkit-border-bottom-left-radius: 6px; -moz-border-radius-bottomleft: 6px; -khtml-border-bottom-left-radius: 6px;
}

div.smiliesDropdownFull {
        margin: 0 30px 0 30px;
}

.smilieBox {
        display: inline-block;
        vertical-align: middle;
        padding: 2px;
        border: 1px solid transparent;
}

.smilieBox:hover {
        background-color: #fff;
        border: 1px solid #ccc;
        border-radius: 3px;
}

#smiliesDropdownHandle {
        bottom: -20px;
        left: 0px;
        line-height: 19px;
        text-align: center;
        width: 100%;
}

#smiliesDropdownHandle a {
        font-size: 11px;
        color: #666;
        background-color: #f0f0ee;
        margin: -1px auto 0 auto;
        border: 1px solid #ccc;
        border-bottom-right-radius: 10px; -webkit-border-bottom-right-radius: 10px; -moz-border-radius-bottomright: 10px; -khtml-border-bottom-right-radius: 10px;
        border-bottom-left-radius: 10px; -webkit-border-bottom-left-radius: 10px; -moz-border-radius-bottomleft: 10px; -khtml-border-bottom-left-radius: 10px;
        display: block;
        outline: 0;
        width: 200px;
}]]></template>
    <template title="editor_smiliesDropdown_js_setup" version_id="1" version_string="1.0.0"><![CDATA[$('#smiliesDropdown').hide();
$('#smiliesDropdownHandle a').toggle(
	function(){ $('#smiliesDropdown').xfFadeDown(0); },
	function(){ $('#smiliesDropdown').xfFadeUp(0); }
);

$('#smiliesDropdownHandle a').click(function(e) { e.preventDefault(); });

var smilies = tinymce.settings.xenforo_smilies,
	DOM = tinymce.DOM;
	
tinymce.each(smilies, function(smilie, smilieName)
{
   	if (typeof smilies === 'undefined' || smilies.length === 0 || smilies === {}){ return; };

	var smilieFile  = DOM.encode(smilie[1]),
		smilieTitle = DOM.encode(smilie[0]),
		smilieCode  = DOM.encode(smilieName);
	var smilieLink  = '<img src="' + smilieFile + '" title="' + smilieTitle + '" alt="' + smilieCode + '" class="smilie" />';
	$('#smiliesDropdown').append('<span class="smilieBox" alt="' + smilieTitle + '">' + smilieLink + '</span>');
});
$('#smiliesDropdown span').each(function(index) {
	$(this).click(function () {
		tinymce.execCommand('mceInsertContent', false, '<img src="' + $(this).children().attr("src") + '" alt="' + $(this).children().attr("alt") + '"class="smilie" data-smilie="yes" />' );
	});
});]]></template>
    <template title="editor_smiliesDropdown_quick_reply" version_id="3" version_string="1.0.2"><![CDATA[<div id="smiliesDropdown"></div>
<h3 id="smiliesDropdownHandle"><a href="#">{xen:phrase smilies}</a></h3>]]></template>
  </templates>
</addon>
